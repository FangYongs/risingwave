(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[755],{56029:function(e,t,n){var r=n(33448);e.exports=function(e,t,n){for(var o=-1,l=e.length;++o<l;){var i=e[o],a=t(i);if(null!=a&&(void 0===c?a==a&&!r(a):n(a,c)))var c=a,s=i}return s}},53325:function(e){e.exports=function(e,t){return e>t}},6162:function(e,t,n){var r=n(56029),o=n(53325),l=n(6557);e.exports=function(e){return e&&e.length?r(e,l,o):void 0}},31351:function(e){var t=Array.prototype.reverse;e.exports=function(e){return null==e?e:t.call(e)}},61603:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dependency_graph",function(){return n(18320)}])},18515:function(e,t,n){"use strict";n.d(t,{D:function(){return CatalogModal},r:function(){return useCatalogModal}});var r=n(85893),o=n(50471),l=n(47741),i=n(41664),a=n.n(i),c=n(95100),s=n(35413),d=n(37655);function useCatalogModal(e){let[t,n]=(0,c.v1)("modalId",c.U),r=null==e?void 0:e.find(e=>e.id===t);return[r,n]}function CatalogModal(e){let{modalData:t,onClose:n}=e;return(0,r.jsxs)(o.u_,{isOpen:void 0!==t,onClose:n,size:"3xl",children:[(0,r.jsx)(o.ZA,{}),(0,r.jsxs)(o.hz,{children:[(0,r.jsxs)(o.xB,{children:["Catalog of ",t&&(0,s.ks)(t)," ",null==t?void 0:t.id," - ",null==t?void 0:t.name]}),(0,r.jsx)(o.ol,{}),(0,r.jsx)(o.fe,{children:t&&(0,r.jsx)(d.Rm,{src:t,collapsed:1,name:null,displayDataTypes:!1})}),(0,r.jsxs)(o.mz,{children:[t&&(0,s.vx)(t)&&(0,r.jsx)(l.zx,{colorScheme:"blue",mr:3,children:(0,r.jsx)(a(),{href:"/fragment_graph/?id=".concat(t.id),children:"View Fragments"})}),(0,r.jsx)(l.zx,{mr:3,onClick:n,children:"Close"})]})]})]})}},37655:function(e,t,n){"use strict";n.d(t,{Rm:function(){return N},KB:function(){return Relations},Kf:function(){return D},gU:function(){return M},vk:function(){return E},vP:function(){return I},sW:function(){return G}});var r=n(85893),o=n(47741),l=n(40639),i=n(67294),a=n(32067),c=n(54520),s=n(28387),cx=(...e)=>e.filter(Boolean).join(" "),[d,u]=(0,s.k)({name:"TableStylesContext",errorMessage:"useTableStyles returned is 'undefined'. Seems you forgot to wrap the components in \"<Table />\" "}),f=(0,a.Gp)((e,t)=>{let n=(0,a.jC)("Table",e),{className:r,...o}=(0,c.Lr)(e);return i.createElement(d,{value:n},i.createElement(a.m$.table,{role:"table",ref:t,__css:n.table,className:cx("chakra-table",r),...o}))});f.displayName="Table";var p=(0,a.Gp)((e,t)=>{let{overflow:n,overflowX:r,className:o,...l}=e;return i.createElement(a.m$.div,{ref:t,className:cx("chakra-table__container",o),...l,__css:{display:"block",whiteSpace:"nowrap",WebkitOverflowScrolling:"touch",overflowX:n??r??"auto",overflowY:"hidden",maxWidth:"100%"}})});(0,a.Gp)((e,t)=>{let{placement:n="bottom",...r}=e,o=u();return i.createElement(a.m$.caption,{...r,ref:t,__css:{...o.caption,captionSide:n}})}).displayName="TableCaption";var h=(0,a.Gp)((e,t)=>{let n=u();return i.createElement(a.m$.thead,{...e,ref:t,__css:n.thead})}),m=(0,a.Gp)((e,t)=>{let n=u();return i.createElement(a.m$.tbody,{...e,ref:t,__css:n.tbody})});(0,a.Gp)((e,t)=>{let n=u();return i.createElement(a.m$.tfoot,{...e,ref:t,__css:n.tfoot})});var g=(0,a.Gp)(({isNumeric:e,...t},n)=>{let r=u();return i.createElement(a.m$.th,{...t,ref:n,__css:r.th,"data-is-numeric":e})}),x=(0,a.Gp)((e,t)=>{let n=u();return i.createElement(a.m$.tr,{role:"row",...e,ref:t,__css:n.tr})}),v=(0,a.Gp)(({isNumeric:e,...t},n)=>{let r=u();return i.createElement(a.m$.td,{role:"gridcell",...t,ref:n,__css:r.td,"data-is-numeric":e})}),y=n(63679),w=n(9008),j=n.n(w),b=n(41664),S=n.n(b),_=n(44527);function extractColumnInfo(e){var t,n,r,o;return"columnDesc"in e?"".concat(null===(t=e.columnDesc)||void 0===t?void 0:t.name," (").concat(null===(r=e.columnDesc)||void 0===r?void 0:null===(n=r.columnType)||void 0===n?void 0:n.typeName,")"):"".concat(e.name," (").concat(null===(o=e.dataType)||void 0===o?void 0:o.typeName,")")}var k=n(30707),C=n(18515);let N=(0,y.ZP)(()=>n.e(171).then(n.t.bind(n,55171,23))),E={name:"Depends",width:1,content:e=>(0,r.jsx)(S(),{href:"/dependency_graph/?id=".concat(e.id),children:(0,r.jsx)(o.zx,{size:"sm","aria-label":"view dependents",colorScheme:"blue",variant:"link",children:"D"})})},I={name:"Primary Key",width:1,content:e=>e.pk.map(e=>e.columnIndex).map(t=>e.columns[t]).map(e=>extractColumnInfo(e)).join(", ")},M={name:"Connector",width:3,content:e=>{var t;return null!==(t=e.withProperties.connector)&&void 0!==t?t:"unknown"}},D={name:"Connector",width:3,content:e=>{var t;return null!==(t=e.properties.connector)&&void 0!==t?t:"unknown"}},G=[E,{name:"Fragments",width:1,content:e=>(0,r.jsx)(S(),{href:"/fragment_graph/?id=".concat(e.id),children:(0,r.jsx)(o.zx,{size:"sm","aria-label":"view fragments",colorScheme:"blue",variant:"link",children:"F"})})}];function Relations(e,t,n){let{response:a}=(0,k.Z)(t),[c,s]=(0,C.r)(a),d=(0,r.jsx)(C.D,{modalData:c,onClose:()=>s(null)}),u=(0,r.jsxs)(l.xu,{p:3,children:[(0,r.jsx)(_.Z,{children:e}),(0,r.jsx)(p,{children:(0,r.jsxs)(f,{variant:"simple",size:"sm",maxWidth:"full",children:[(0,r.jsx)(h,{children:(0,r.jsxs)(x,{children:[(0,r.jsx)(g,{width:3,children:"Id"}),(0,r.jsx)(g,{width:5,children:"Name"}),(0,r.jsx)(g,{width:3,children:"Owner"}),n.map(e=>(0,r.jsx)(g,{width:e.width,children:e.name},e.name)),(0,r.jsx)(g,{children:"Visible Columns"})]})}),(0,r.jsx)(m,{children:null==a?void 0:a.map(e=>(0,r.jsxs)(x,{children:[(0,r.jsx)(v,{children:(0,r.jsx)(o.zx,{size:"sm","aria-label":"view catalog",colorScheme:"blue",variant:"link",onClick:()=>s(e.id),children:e.id})}),(0,r.jsx)(v,{children:e.name}),(0,r.jsx)(v,{children:e.owner}),n.map(t=>(0,r.jsx)(v,{children:t.content(e)},t.name)),(0,r.jsx)(v,{overflowWrap:"normal",children:e.columns.filter(e=>!("isHidden"in e)||!e.isHidden).map(e=>extractColumnInfo(e)).join(", ")})]},e.id))})]})})]});return(0,r.jsxs)(i.Fragment,{children:[(0,r.jsx)(j(),{children:(0,r.jsx)("title",{children:e})}),d,u]})}},67670:function(e,t,n){"use strict";n.d(t,{A8:function(){return layoutItem},AJ:function(){return generateRelationEdges},Sx:function(){return flipLayoutRelation},jI:function(){return generateFragmentEdges}});var r=n(6162),o=n.n(r);function layoutItem(e,t,n){let r=function(e){let t=new Map;for(let n of e)t.set(n.id,n);let n=new Map,r=new Map,getNode=e=>{let o=r.get(e);if(void 0!==o)return o;let l={nextNodes:[]},i=t.get(e);if(void 0===i)throw Error("no such id ".concat(e));for(let e of i.parentIds)getNode(e).nextNodes.push(l);return r.set(e,l),n.set(l,e),l};for(let t of e)getNode(t.id);let o=new Map,l=[];for(let e of n.keys())l.push(e);for(let e of function(e){let t=[],n=[],r=new Map,visit=e=>{if(e.temp)throw Error("This is not a DAG");if(!e.perm){e.temp=!0;let n=-1;for(let t of e.node.nextNodes){r.get(t).isInput=!1,e.isOutput=!1;let o=visit(r.get(t));o>n&&(n=o)}e.temp=!1,e.perm=!0,e.g=n+1,t.unshift(e.node)}return e.g};for(let t of e){let e={node:t,temp:!1,perm:!1,isInput:!0,isOutput:!0,g:0};r.set(t,e),n.push(e)}let o=0;for(let e of n){let t=visit(e);t>o&&(o=t)}for(let e of n)e.g=o-e.g;let l=[];for(let e=0;e<o+1;++e)l.push({nodes:[],occupyRow:new Set});let i=new Map,a=new Map;for(let e of n)l[e.g].nodes.push(e.node),i.set(e.node,e.g);let putNodeInPosition=(e,t)=>{a.set(e,t),l[i.get(e)].occupyRow.add(t)},occupyLine=(e,t,n)=>{for(let r=e;r<=t;++r)l[r].occupyRow.add(n)},hasOccupied=(e,t)=>l[e].occupyRow.has(t),isStraightLineOccupied=(e,t,n)=>{if(n<0)return!1;for(let r=e;r<=t;++r)if(hasOccupied(r,n))return!0;return!1};for(let t of e)t.nextNodes.sort((e,t)=>i.get(t)-i.get(e));for(let e of l)for(let t of e.nodes){if(!a.has(t)){for(let e of t.nextNodes){if(a.has(e))continue;let n=-1;for(;isStraightLineOccupied(i.get(t),i.get(e),++n););putNodeInPosition(t,n),putNodeInPosition(e,n),occupyLine(i.get(t)+1,i.get(e)-1,n);break}if(!a.has(t)){let e=-1;for(;hasOccupied(i.get(t),++e););putNodeInPosition(t,e)}}for(let e of t.nextNodes){if(a.has(e))continue;let n=a.get(t);if(!isStraightLineOccupied(i.get(t)+1,i.get(e),n)){putNodeInPosition(e,n),occupyLine(i.get(t)+1,i.get(e)-1,n);continue}for(n=-1;isStraightLineOccupied(i.get(t)+1,i.get(e),++n););putNodeInPosition(e,n),occupyLine(i.get(t)+1,i.get(e)-1,n)}}let c=new Map;for(let t of e)c.set(t,[i.get(t),a.get(t)]);return c}(l)){let r=n.get(e[0]);if(!r)throw Error("no corresponding item of node ".concat(e[0]));let l=t.get(r);if(!l)throw Error("item id ".concat(r," is not present in idToBox"));o.set(l,e[1])}return o}(e),l=new Map,i=new Map,a=0,c=0;for(let e of r){let t=e[0],n=e[1][0],r=e[1][1],s=l.get(n)||0;t.width>s&&l.set(n,t.width);let d=i.get(r)||0;t.height>d&&i.set(r,t.height),a=o()([n,a])||0,c=o()([r,c])||0}let s=new Map,d=new Map,getCumulativeMargin=(e,t,n,r)=>{let o=n.get(e);if(o)return o;if(0===e)o=0;else{let l=r.get(e-1);if(!l)throw Error("".concat(e-1," has no result"));o=getCumulativeMargin(e-1,t,n,r)+l+t}return n.set(e,o),o};for(let e=0;e<=a;++e)getCumulativeMargin(e,t,s,l);for(let e=0;e<=c;++e)getCumulativeMargin(e,n,d,i);let u=[];for(let[e,[t,n]]of r){let r=s.get(t),o=d.get(n);if(void 0!==r&&void 0!==o)u.push({x:r,y:o,...e});else throw Error("x of layer ".concat(t,": ").concat(r,", y of row ").concat(n,": ").concat(o," "))}return u}function flipLayoutRelation(e,t,n,r){let o=function(e,t,n,r){let o=layoutItem(e,t,n);return o.map(e=>{let{x:t,y:n,...o}=e;return{x:t+r,y:n+r,...o}})}(e,n,t,r);return o.map(e=>{let{x:t,y:n,...r}=e;return{x:n,y:t,...r}})}function generateRelationEdges(e){let t=[],n=new Map;for(let t of e)n.set(t.id,t);for(let r of e)for(let e of r.parentIds){let o=n.get(e);t.push({points:[{x:r.x,y:r.y},{x:o.x,y:o.y}],source:r.id,target:e})}return t}function generateFragmentEdges(e){let t=[],n=new Map;for(let t of e)n.set(t.id,t);for(let r of e){for(let e of r.parentIds){let o=n.get(e);t.push({points:[{x:r.x+r.width/2,y:r.y+r.height/2},{x:o.x+o.width/2,y:o.y+o.height/2}],source:r.id,target:e})}for(let e of r.externalParentIds)t.push({points:[{x:r.x,y:r.y+r.height/2},{x:r.x+100,y:r.y+r.height/2}],source:r.id,target:e})}return t}},18320:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return StreamingGraph}});var r=n(85893),o=n(40639),l=n(47741),i=n(31351),a=n.n(i),c=n(89734),s=n.n(c),d=n(9008),u=n.n(d),f=n(95100),p=n(67294),h=n(52189),m=n(79855),g=n(67670),x=n(35413),v=n(18515);function RelationDependencyGraph(e){let{nodes:t,selectedId:n,setSelectedId:o}=e,[l,i]=(0,v.r)(t.map(e=>e.relation)),a=(0,p.useRef)(null),c=(0,p.useCallback)(()=>{let e=(0,g.Sx)(t,50,50,12).map(e=>{let{x:t,y:n,...r}=e;return{x:t+50,y:n+50,...r}}),n=(0,g.AJ)(e),{width:r,height:o}=function(e,t){let n=0,r=0;for(let{x:o,y:l}of e)n=Math.max(n,o+t),r=Math.max(r,l+t);return{width:n,height:r}}(e,12);return{layoutMap:e,links:n,width:r+50+100,height:o+50+100}},[t]),{layoutMap:s,width:d,height:u,links:f}=c();return(0,p.useEffect)(()=>{let e=a.current,t=m.Ys(e),r=m.ak_,l=m.jvg().curve(r).x(e=>{let{x:t}=e;return t}).y(e=>{let{y:t}=e;return t}),c=t.select(".edges").selectAll(".edge").data(f),isSelected=e=>e===n,applyEdge=e=>e.attr("d",e=>{let{points:t}=e;return l(t)}).attr("fill","none").attr("stroke-width",1).attr("stroke-width",e=>isSelected(e.source)||isSelected(e.target)?4:2).attr("opacity",e=>isSelected(e.source)||isSelected(e.target)?1:.5).attr("stroke",e=>isSelected(e.source)||isSelected(e.target)?h.rS.colors.blue["500"]:h.rS.colors.gray["300"]);c.exit().remove(),c.enter().call(e=>e.append("path").attr("class","edge").call(applyEdge)),c.call(applyEdge);let applyNode=e=>{e.attr("transform",e=>{let{x:t,y:n}=e;return"translate(".concat(t,",").concat(n,")")});let t=e.select("circle");t.empty()&&(t=e.append("circle")),t.attr("r",12).attr("fill",e=>{let{id:t,relation:n}=e,r=(0,x.vx)(n)?"500":"400";return isSelected(t)?h.rS.colors.blue[r]:h.rS.colors.gray[r]});let n=e.select(".text");n.empty()&&(n=e.append("text").attr("class","text")),n.attr("fill","black").text(e=>{let{name:t}=e;return t}).attr("font-family","inherit").attr("text-anchor","middle").attr("dy",24).attr("font-size",12).attr("transform","rotate(-8)");let r=e.select(".type");r.empty()&&(r=e.append("text").attr("class","type"));let relationTypeAbbr=e=>{let t=(0,x.Mk)(e);return"SINK"===t?"K":t.charAt(0)};r.attr("fill","white").text(e=>{let{relation:t}=e;return"".concat(relationTypeAbbr(t))}).attr("font-family","inherit").attr("text-anchor","middle").attr("dy",6).attr("font-size",16).attr("font-weight","bold");let l=e.select("title");return l.empty()&&(l=e.append("title")),l.text(e=>{let{relation:t}=e;return"".concat(t.name," (").concat((0,x.ks)(t),")")}),e.style("cursor","pointer").on("click",(e,t)=>{let{relation:n,id:r}=t;o(r),i(n.id)}),e},d=t.select(".boxes"),u=d.selectAll(".node").data(s);u.enter().call(e=>e.append("g").attr("class","node").call(applyNode)),u.call(applyNode),u.exit().remove()},[s,f,n,i,o]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{ref:a,width:"".concat(d,"px"),height:"".concat(u,"px"),children:[(0,r.jsx)("g",{className:"edges"}),(0,r.jsx)("g",{className:"boxes"})]}),(0,r.jsx)(v.D,{modalData:l,onClose:()=>i(null)})]})}var y=n(44527),w=n(30707);let j="200px";function StreamingGraph(){let{response:e}=(0,w.Z)(x.H4),[t,n]=(0,f.v1)("id",f.U),i=(0,p.useCallback)(()=>e?function(e){let t=[],n=new Set(e.map(e=>e.id));for(let r of a()(s()(e,"id")))t.push({id:r.id.toString(),name:r.name,parentIds:(0,x.vx)(r)?r.dependentRelations.filter(e=>n.has(e)).map(e=>e.toString()):[],order:r.id,width:24,height:24,relation:r});return t}(e):void 0,[e]),c=i(),d=(0,r.jsxs)(o.kC,{p:3,height:"calc(100vh - 20px)",flexDirection:"column",children:[(0,r.jsx)(y.Z,{children:"Dependency Graph"}),(0,r.jsxs)(o.kC,{flexDirection:"row",height:"full",children:[(0,r.jsxs)(o.kC,{width:j,height:"full",maxHeight:"full",mr:3,alignItems:"flex-start",flexDirection:"column",children:[(0,r.jsx)(o.xv,{fontWeight:"semibold",mb:3,children:"Relations"}),(0,r.jsx)(o.xu,{flex:1,overflowY:"scroll",children:(0,r.jsx)(o.gC,{width:j,align:"start",spacing:1,children:null==e?void 0:e.map(e=>{let o=t===e.id;return(0,r.jsx)(l.zx,{colorScheme:o?"blue":"gray",color:o?"blue.600":"gray.500",variant:o?"outline":"ghost",py:0,height:8,justifyContent:"flex-start",onClick:()=>n(e.id),children:e.name},e.id)})})})]}),(0,r.jsxs)(o.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:[(0,r.jsx)(o.xv,{fontWeight:"semibold",children:"Dependency Graph"}),c&&(0,r.jsx)(RelationDependencyGraph,{nodes:c,selectedId:null==t?void 0:t.toString(),setSelectedId:e=>n(parseInt(e))})]})]})]});return(0,r.jsxs)(p.Fragment,{children:[(0,r.jsx)(u(),{children:(0,r.jsx)("title",{children:"Streaming Graph"})}),d]})}}},function(e){e.O(0,[662,679,184,145,591,855,284,30,774,888,179],function(){return e(e.s=61603)}),_N_E=e.O()}]);